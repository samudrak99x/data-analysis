"""\nCustomer Churn Analysis - Data Visualization Task\n\nThis script generates 10 professional charts analyzing customer churn patterns\nacross various dimensions including contract type, payment method, tenure, and more.\n\nDataset: customer_churn.csv (1,000 customers, 10 fields)\nCharts: 10 PNG visualizations analyzing churn patterns\nOutput: ./outputs/ directory\n\nAuthor: @data-dev (Orchestrator Workflow)\nDate: 2026-01-02\nVersion: 1.0\n"""\n\n# Standard library imports\nfrom pathlib import Path\nimport sys\n\n# Third-party imports\nimport pandas as pd\nimport numpy as np\nimport matplotlib.pyplot as plt\nimport seaborn as sns\n\n# ============================================================================\n# TASK 1: SETUP & CONFIGURATION\n# ============================================================================\n\n# Subtask 1.1: Define color constants (from specification)\nCHURN_RED = '#e74c3c'        # Churned customers (red)\nRETAIN_GREEN = '#2ecc71'     # Active customers (green)\nNEUTRAL_BLUE = '#3498db'     # Neutral/primary color\nWARNING_ORANGE = '#f39c12'   # Secondary color\n\n# Subtask 1.2: Configure output directory\nOUTPUT_DIR = Path('outputs')\nOUTPUT_DIR.mkdir(parents=True, exist_ok=True)\n\n# Subtask 1.3: Configure matplotlib style\nplt.style.use('seaborn-v0_8-darkgrid')\nsns.set_palette(\"husl\")\n\n# Visualization defaults\nDEFAULT_DPI = 100\nDEFAULT_FIGSIZE = (10, 6)\n\n# ============================================================================\n# TASK 2: DATA LOADING & PREPARATION\n# ============================================================================\n\ndef load_data(filepath: str) -> pd.DataFrame:\n    \"\"\"\n    Load and validate customer churn dataset.\n    \n    Subtask 2.1: File validation and loading\n    Subtask 2.2: Column validation\n    Subtask 2.3: Data type conversions\n    \n    Args:\n        filepath: Path to customer_churn.csv\n        \n    Returns:\n        Validated pandas DataFrame with proper data types\n        \n    Raises:\n        FileNotFoundError: If data file doesn't exist\n        ValueError: If required columns are missing\n    \"\"\"\n    # Subtask 2.1: File validation\n    data_path = Path(filepath)\n    if not data_path.exists():\n        raise FileNotFoundError(f\"Data file not found: {filepath}\")\n    \n    # Load CSV\n    df = pd.read_csv(data_path)\n    \n    # Subtask 2.2: Validate required columns\n    required_columns = [\n        'customer_id', 'age', 'tenure_months', 'monthly_charges',\n        'total_charges', 'num_products', 'num_support_calls',\n        'contract_type', 'payment_method', 'churned'\n    ]\n    \n    missing_cols = set(required_columns) - set(df.columns)\n    if missing_cols:\n        raise ValueError(f\"Missing required columns: {missing_cols}\")\n    \n    # Subtask 2.3: Data type conversions\n    numeric_cols = [\n        'age', 'tenure_months', 'monthly_charges', 'total_charges',\n        'num_products', 'num_support_calls', 'churned'\n    ]\n    \n    for col in numeric_cols:\n        df[col] = pd.to_numeric(df[col], errors='coerce')\n    \n    return df\n\n# ============================================================================\n# TASK 3: CHART GENERATION FUNCTIONS (10 Functions)\n# ============================================================================\n\ndef create_churn_pie(df: pd.DataFrame) -> None:\n    \"\"\"\n    Subtask 3.1: Chart 1 - Churn Rate Overview (Pie Chart)\n    \n    Shows overall churn rate distribution with percentages.\n    Green for active customers, red for churned.\n    \"\"\"\n    # Data preparation\n    churn_counts = df['churned'].value_counts().sort_index()\n    labels = ['Active Customers', 'Churned Customers']\n    colors = [RETAIN_GREEN, CHURN_RED]\n    \n    # Create plot\n    fig, ax = plt.subplots(figsize=(8, 6))\n    wedges, texts, autotexts = ax.pie(\n        churn_counts.values,\n        labels=labels,\n        autopct='%1.1f%%',\n        startangle=90,\n        colors=colors,\n        explode=(0, 0.1),  # Explode churned slice slightly\n        textprops={'fontsize': 11}\n    )\n    \n    # Style\n    ax.set_title('Customer Churn Rate Distribution', fontsize=14, fontweight='bold')\n    \n    # Make percentage text bold\n    for autotext in autotexts:\n        autotext.set_color('white')\n        autotext.set_fontweight('bold')\n    \n    # Save\n    output_path = OUTPUT_DIR / '01_churn_rate_overview.png'\n    plt.tight_layout()\n    plt.savefig(output_path, dpi=DEFAULT_DPI, bbox_inches='tight')\n    plt.close()\n    print(f\"  [OK] Saved: 01_churn_rate_overview.png\")\n\n\ndef create_churn_by_contract(df: pd.DataFrame) -> None:\n    \"\"\"\n    Subtask 3.2: Chart 2 - Churn by Contract Type (Grouped Bar Chart)\n    \n    Shows active vs churned customers grouped by contract type.\n    \"\"\"\n    # Data preparation\n    contract_churn = df.groupby(['contract_type', 'churned']).size().unstack(fill_value=0)\n    \n    # Create plot\n    fig, ax = plt.subplots(figsize=DEFAULT_FIGSIZE)\n    x = np.arange(len(contract_churn.index))\n    width = 0.35\n    \n    bars1 = ax.bar(x - width/2, contract_churn[0], width, \n                   label='Active', color=RETAIN_GREEN)\n    bars2 = ax.bar(x + width/2, contract_churn[1], width,\n                   label='Churned', color=CHURN_RED)\n    \n    # Add value labels on bars\n    for bars in [bars1, bars2]:\n        for bar in bars:\n            height = bar.get_height()\n            ax.text(bar.get_x() + bar.get_width()/2., height,\n                   f'{int(height)}', ha='center', va='bottom', fontsize=9)\n    \n    # Style\n    ax.set_title('Customer Churn by Contract Type', fontsize=14, fontweight='bold')\n    ax.set_xlabel('Contract Type', fontsize=11)\n    ax.set_ylabel('Number of Customers', fontsize=11)\n    ax.set_xticks(x)\n    ax.set_xticklabels(contract_churn.index)\n    ax.legend(loc='upper right')\n    ax.grid(axis='y', alpha=0.3)\n    \n    # Save\n    output_path = OUTPUT_DIR / '02_churn_by_contract_type.png'\n    plt.tight_layout()\n    plt.savefig(output_path, dpi=DEFAULT_DPI, bbox_inches='tight')\n    plt.close()\n    print(f\"  [OK] Saved: 02_churn_by_contract_type.png\")\n\n\ndef create_churn_by_payment(df: pd.DataFrame) -> None:\n    \"\"\"\n    Subtask 3.3: Chart 3 - Churn Rate by Payment Method (Stacked Bar Chart)\n    \n    Shows churn rate percentages for each payment method.\n    \"\"\"\n    # Data preparation - cross-tab and normalize to percentages\n    payment_churn = pd.crosstab(df['payment_method'], df['churned'], normalize='index') * 100\n    \n    # Create plot\n    fig, ax = plt.subplots(figsize=DEFAULT_FIGSIZE)\n    \n    # Plot stacked bars (100% normalized)\n    payment_churn.plot(kind='bar', stacked=True, ax=ax,\n                       color=[RETAIN_GREEN, CHURN_RED],\n                       width=0.7)\n    \n    # Style\n    ax.set_title('Churn Rate by Payment Method (%)', fontsize=14, fontweight='bold')\n    ax.set_xlabel('Payment Method', fontsize=11)\n    ax.set_ylabel('Percentage (%)', fontsize=11)\n    ax.set_xticklabels(ax.get_xticklabels(), rotation=45, ha='right')\n    ax.legend(['Active', 'Churned'], loc='upper right')\n    ax.grid(axis='y', alpha=0.3)\n    ax.set_ylim(0, 100)\n    \n    # Save\n    output_path = OUTPUT_DIR / '03_churn_by_payment_method.png'\n    plt.tight_layout()\n    plt.savefig(output_path, dpi=DEFAULT_DPI, bbox_inches='tight')\n    plt.close()\n    print(f\"  [OK] Saved: 03_churn_by_payment_method.png\")\n\n\ndef create_tenure_boxplot(df: pd.DataFrame) -> None:\n    \"\"\"\n    Subtask 3.4: Chart 4 - Tenure vs Churn (Box Plot)\n    \n    Shows distribution of customer tenure for active vs churned customers.\n    \"\"\"\n    # Data preparation\n    df_plot = df.copy()\n    df_plot['Status'] = df_plot['churned'].map({0: 'Active', 1: 'Churned'})\n    \n    # Create plot\n    fig, ax = plt.subplots(figsize=DEFAULT_FIGSIZE)\n    \n    # Box plot with custom colors\n    bp = ax.boxplot(\n        [df_plot[df_plot['churned'] == 0]['tenure_months'],\n         df_plot[df_plot['churned'] == 1]['tenure_months']],\n        labels=['Active', 'Churned'],\n        patch_artist=True,\n        widths=0.6\n    )\n    \n    # Color the boxes\n    bp['boxes'][0].set_facecolor(RETAIN_GREEN)\n    bp['boxes'][1].set_facecolor(CHURN_RED)\n    \n    for box in bp['boxes']:\n        box.set_alpha(0.7)\n    \n    # Style\n    ax.set_title('Customer Tenure Distribution by Churn Status', fontsize=14, fontweight='bold')\n    ax.set_xlabel('Customer Status', fontsize=11)\n    ax.set_ylabel('Tenure (Months)', fontsize=11)\n    ax.grid(axis='y', alpha=0.3)\n    \n    # Save\n    output_path = OUTPUT_DIR / '04_tenure_vs_churn_boxplot.png'\n    plt.tight_layout()\n    plt.savefig(output_path, dpi=DEFAULT_DPI, bbox_inches='tight')\n    plt.close()\n    print(f\"  [OK] Saved: 04_tenure_vs_churn_boxplot.png\")\n\n\ndef create_churn_by_products(df: pd.DataFrame) -> None:\n    \"\"\"\n    Subtask 3.5: Chart 5 - Churn by Number of Products (Grouped Bar Chart)\n    \n    Shows active vs churned customers by number of products subscribed.\n    \"\"\"\n    # Data preparation\n    products_churn = df.groupby(['num_products', 'churned']).size().unstack(fill_value=0)\n    \n    # Create plot\n    fig, ax = plt.subplots(figsize=DEFAULT_FIGSIZE)\n    x = np.arange(len(products_churn.index))\n    width = 0.35\n    \n    bars1 = ax.bar(x - width/2, products_churn[0], width,\n                   label='Active', color=RETAIN_GREEN)\n    bars2 = ax.bar(x + width/2, products_churn[1], width,\n                   label='Churned', color=CHURN_RED)\n    \n    # Add value labels\n    for bars in [bars1, bars2]:\n        for bar in bars:\n            height = bar.get_height()\n            ax.text(bar.get_x() + bar.get_width()/2., height,\n                   f'{int(height)}', ha='center', va='bottom', fontsize=9)\n    \n    # Style\n    ax.set_title('Customer Churn by Number of Products', fontsize=14, fontweight='bold')\n    ax.set_xlabel('Number of Products', fontsize=11)\n    ax.set_ylabel('Number of Customers', fontsize=11)\n    ax.set_xticks(x)\n    ax.set_xticklabels(products_churn.index)\n    ax.legend(loc='upper right')\n    ax.grid(axis='y', alpha=0.3)\n    \n    # Save\n    output_path = OUTPUT_DIR / '05_churn_by_num_products.png'\n    plt.tight_layout()\n    plt.savefig(output_path, dpi=DEFAULT_DPI, bbox_inches='tight')\n    plt.close()\n    print(f\"  [OK] Saved: 05_churn_by_num_products.png\")\n\n\ndef create_churn_by_support(df: pd.DataFrame) -> None:\n    \"\"\"\n    Subtask 3.6: Chart 6 - Churn by Support Calls (Grouped Bar Chart)\n    \n    Shows active vs churned customers by number of support calls made.\n    \"\"\"\n    # Data preparation\n    support_churn = df.groupby(['num_support_calls', 'churned']).size().unstack(fill_value=0)\n    \n    # Create plot\n    fig, ax = plt.subplots(figsize=DEFAULT_FIGSIZE)\n    x = np.arange(len(support_churn.index))\n    width = 0.35\n    \n    bars1 = ax.bar(x - width/2, support_churn[0], width,\n                   label='Active', color=RETAIN_GREEN)\n    bars2 = ax.bar(x + width/2, support_churn[1], width,\n                   label='Churned', color=CHURN_RED)\n    \n    # Add value labels\n    for bars in [bars1, bars2]:\n        for bar in bars:\n            height = bar.get_height()\n            ax.text(bar.get_x() + bar.get_width()/2., height,\n                   f'{int(height)}', ha='center', va='bottom', fontsize=9)\n    \n    # Style\n    ax.set_title('Customer Churn by Number of Support Calls', fontsize=14, fontweight='bold')\n    ax.set_xlabel('Number of Support Calls', fontsize=11)\n    ax.set_ylabel('Number of Customers', fontsize=11)\n    ax.set_xticks(x)\n    ax.set_xticklabels(support_churn.index)\n    ax.legend(loc='upper left')\n    ax.grid(axis='y', alpha=0.3)\n    \n    # Save\n    output_path = OUTPUT_DIR / '06_churn_by_support_calls.png'\n    plt.tight_layout()\n    plt.savefig(output_path, dpi=DEFAULT_DPI, bbox_inches='tight')\n    plt.close()\n    print(f\"  [OK] Saved: 06_churn_by_support_calls.png\")\n\n\ndef create_age_histogram(df: pd.DataFrame) -> None:\n    \"\"\"\n    Subtask 3.7: Chart 7 - Age Distribution (Histogram)\n    \n    Shows distribution of customer ages with KDE overlay.\n    \"\"\"\n    # Create plot\n    fig, ax = plt.subplots(figsize=DEFAULT_FIGSIZE)\n    \n    # Histogram with KDE\n    ax.hist(df['age'], bins=15, color=NEUTRAL_BLUE, alpha=0.7, edgecolor='black')\n    \n    # Add KDE overlay\n    from scipy import stats\n    kde = stats.gaussian_kde(df['age'].dropna())\n    x_range = np.linspace(df['age'].min(), df['age'].max(), 100)\n    kde_values = kde(x_range)\n    ax2 = ax.twinx()\n    ax2.plot(x_range, kde_values, color='darkblue', linewidth=2, label='KDE')\n    ax2.set_ylabel('Density', fontsize=11)\n    ax2.legend(loc='upper right')\n    \n    # Style\n    ax.set_title('Customer Age Distribution', fontsize=14, fontweight='bold')\n    ax.set_xlabel('Age (Years)', fontsize=11)\n    ax.set_ylabel('Number of Customers', fontsize=11)\n    ax.grid(axis='y', alpha=0.3)\n    \n    # Save\n    output_path = OUTPUT_DIR / '07_age_distribution.png'\n    plt.tight_layout()\n    plt.savefig(output_path, dpi=DEFAULT_DPI, bbox_inches='tight')\n    plt.close()\n    print(f\"  [OK] Saved: 07_age_distribution.png\")\n\n\ndef create_charges_violin(df: pd.DataFrame) -> None:\n    \"\"\"\n    Subtask 3.8: Chart 8 - Monthly Charges by Churn Status (Violin Plot)\n    \n    Shows distribution of monthly charges for active vs churned customers.\n    \"\"\"\n    # Data preparation\n    df_plot = df.copy()\n    df_plot['Status'] = df_plot['churned'].map({0: 'Active', 1: 'Churned'})\n    \n    # Create plot\n    fig, ax = plt.subplots(figsize=DEFAULT_FIGSIZE)\n    \n    # Violin plot with custom colors\n    parts = ax.violinplot(\n        [df_plot[df_plot['churned'] == 0]['monthly_charges'].dropna(),\n         df_plot[df_plot['churned'] == 1]['monthly_charges'].dropna()],\n        positions=[1, 2],\n        showmeans=True,\n        showmedians=True,\n        widths=0.7\n    )\n    \n    # Color the violin plots\n    colors = [RETAIN_GREEN, CHURN_RED]\n    for i, pc in enumerate(parts['bodies']):\n        pc.set_facecolor(colors[i])\n        pc.set_alpha(0.7)\n    \n    # Style\n    ax.set_title('Monthly Charges Distribution by Churn Status', fontsize=14, fontweight='bold')\n    ax.set_xlabel('Customer Status', fontsize=11)\n    ax.set_ylabel('Monthly Charges ($)', fontsize=11)\n    ax.set_xticks([1, 2])\n    ax.set_xticklabels(['Active', 'Churned'])\n    ax.grid(axis='y', alpha=0.3)\n    \n    # Save\n    output_path = OUTPUT_DIR / '08_monthly_charges_violin.png'\n    plt.tight_layout()\n    plt.savefig(output_path, dpi=DEFAULT_DPI, bbox_inches='tight')\n    plt.close()\n    print(f\"  [OK] Saved: 08_monthly_charges_violin.png\")\n\n\ndef create_tenure_histogram(df: pd.DataFrame) -> None:\n    \"\"\"\n    Subtask 3.9: Chart 9 - Tenure Distribution (Histogram)\n    \n    Shows distribution of customer tenure with KDE overlay.\n    \"\"\"\n    # Create plot\n    fig, ax = plt.subplots(figsize=DEFAULT_FIGSIZE)\n    \n    # Histogram with KDE\n    ax.hist(df['tenure_months'], bins=12, color=WARNING_ORANGE, alpha=0.7, edgecolor='black')\n    \n    # Add KDE overlay\n    from scipy import stats\n    kde = stats.gaussian_kde(df['tenure_months'].dropna())\n    x_range = np.linspace(df['tenure_months'].min(), df['tenure_months'].max(), 100)\n    kde_values = kde(x_range)\n    ax2 = ax.twinx()\n    ax2.plot(x_range, kde_values, color='darkorange', linewidth=2, label='KDE')\n    ax2.set_ylabel('Density', fontsize=11)\n    ax2.legend(loc='upper right')\n    \n    # Style\n    ax.set_title('Customer Tenure Distribution', fontsize=14, fontweight='bold')\n    ax.set_xlabel('Tenure (Months)', fontsize=11)\n    ax.set_ylabel('Number of Customers', fontsize=11)\n    ax.grid(axis='y', alpha=0.3)\n    \n    # Save\n    output_path = OUTPUT_DIR / '09_tenure_distribution.png'\n    plt.tight_layout()\n    plt.savefig(output_path, dpi=DEFAULT_DPI, bbox_inches='tight')\n    plt.close()\n    print(f\"  [OK] Saved: 09_tenure_distribution.png\")\n\n\ndef create_contract_payment_heatmap(df: pd.DataFrame) -> None:\n    \"\"\"\n    Subtask 3.10: Chart 10 - Contract Type by Payment Method (Heatmap)\n    \n    Shows customer count distribution across contract type and payment method combinations.\n    \"\"\"\n    # Data preparation - cross-tabulation\n    heatmap_data = pd.crosstab(df['contract_type'], df['payment_method'])\n    \n    # Create plot\n    fig, ax = plt.subplots(figsize=DEFAULT_FIGSIZE)\n    \n    # Heatmap\n    sns.heatmap(\n        heatmap_data,\n        annot=True,\n        fmt='d',\n        cmap='Blues',\n        cbar_kws={'label': 'Number of Customers'},\n        linewidths=0.5,\n        linecolor='gray',\n        ax=ax\n    )\n    \n    # Style\n    ax.set_title('Customer Distribution: Contract Type vs Payment Method', \n                fontsize=14, fontweight='bold', pad=20)\n    ax.set_xlabel('Payment Method', fontsize=11)\n    ax.set_ylabel('Contract Type', fontsize=11)\n    \n    # Save\n    output_path = OUTPUT_DIR / '10_contract_payment_heatmap.png'\n    plt.tight_layout()\n    plt.savefig(output_path, dpi=DEFAULT_DPI, bbox_inches='tight')\n    plt.close()\n    print(f\"  [OK] Saved: 10_contract_payment_heatmap.png\")\n\n\n# ============================================================================\n# TASK 4: MAIN EXECUTION FUNCTION\n# ============================================================================\n\ndef main():\n    \"\"\"\n    Subtask 4.1: Main orchestration function\n    \n    Coordinates the entire workflow:\n    1. Load customer churn data\n    2. Generate all 10 visualizations\n    3. Report summary\n    \"\"\"\n    print(\"=\" * 60)\n    print(\"CUSTOMER CHURN ANALYSIS - VISUALIZATION GENERATION\")\n    print(\"=\" * 60)\n    \n    # Subtask 4.2: Load data\n    print(\"\\n[Step 1/11] Loading customer churn data...\")\n    try:\n        df = load_data('data/customer_churn.csv')\n        print(f\"  Successfully loaded {len(df):,} customer records\")\n        print(f\"  Churn rate: {df['churned'].mean()*100:.1f}%\")\n    except Exception as e:\n        print(f\"  ERROR: Failed to load data - {e}\")\n        sys.exit(1)\n    \n    # Subtask 4.3: Generate all charts\n    print(\"\\n[Step 2/11] Generating Chart 1: Churn Rate Overview...\")\n    create_churn_pie(df)\n    \n    print(\"\\n[Step 3/11] Generating Chart 2: Churn by Contract Type...\")\n    create_churn_by_contract(df)\n    \n    print(\"\\n[Step 4/11] Generating Chart 3: Churn by Payment Method...\")\n    create_churn_by_payment(df)\n    \n    print(\"\\n[Step 5/11] Generating Chart 4: Tenure vs Churn Box Plot...\")\n    create_tenure_boxplot(df)\n    \n    print(\"\\n[Step 6/11] Generating Chart 5: Churn by Number of Products...\")\n    create_churn_by_products(df)\n    \n    print(\"\\n[Step 7/11] Generating Chart 6: Churn by Support Calls...\")\n    create_churn_by_support(df)\n    \n    print(\"\\n[Step 8/11] Generating Chart 7: Age Distribution...\")\n    create_age_histogram(df)\n    \n    print(\"\\n[Step 9/11] Generating Chart 8: Monthly Charges Distribution...\")\n    create_charges_violin(df)\n    \n    print(\"\\n[Step 10/11] Generating Chart 9: Tenure Distribution...\")\n    create_tenure_histogram(df)\n    \n    print(\"\\n[Step 11/11] Generating Chart 10: Contract-Payment Heatmap...\")\n    create_contract_payment_heatmap(df)\n    \n    # Summary\n    output_files = list(OUTPUT_DIR.glob('*.png'))\n    print(\"\\n\" + \"=\" * 60)\n    print(\"TASK COMPLETED SUCCESSFULLY\")\n    print(\"=\" * 60)\n    print(f\"\\nGenerated {len(output_files)} visualizations:\")\n    for file in sorted(output_files):\n        file_size = file.stat().st_size / 1024  # KB\n        print(f\"  - {file.name} ({file_size:.1f} KB)\")\n    print(f\"\\nAll charts saved to: {OUTPUT_DIR.absolute()}\")\n    print(\"\\nNext steps:\")\n    print(\"  1. Review visualizations in outputs/ folder\")\n    print(\"  2. Share insights with stakeholders\")\n    print(\"  3. Use charts in presentations or reports\")\n\n\n# ============================================================================\n# TASK 5: ENTRY POINT\n# ============================================================================\n\nif __name__ == '__main__':\n    main()\n